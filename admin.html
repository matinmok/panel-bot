<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پنل مدیریت طوفان سرور - ادمین</title>
    
    <!-- Enhanced Font Awesome with Multiple CDNs -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://use.fontawesome.com">
    <link rel="preconnect" href="https://pro.fontawesome.com">
    
    <!-- Primary Font Awesome Sources -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet" crossorigin="anonymous">
    <link href="https://use.fontawesome.com/releases/v6.5.1/css/all.css" rel="stylesheet" crossorigin="anonymous">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" crossorigin="anonymous">
    
    <!-- Backup Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css" rel="stylesheet" crossorigin="anonymous">
    
    <!-- Vazir Font Sources -->
    <link href="https://v1.fontapi.ir/css/Vazir" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
    
    <style>
        /* Force Font Awesome Icons to Load */
        @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css');
        @import url('https://use.fontawesome.com/releases/v6.5.1/css/all.css');
        
        /* Enhanced Icon CSS with Fallbacks */
        .fas, .far, .fab, .fa {
            font-family: "Font Awesome 6 Free", "Font Awesome 6 Pro", "Font Awesome 6 Brands", "FontAwesome", "Font Awesome 5 Free", "Font Awesome 5 Pro" !important;
            font-weight: 900 !important;
            font-style: normal !important;
            font-variant: normal !important;
            text-rendering: auto !important;
            line-height: 1 !important;
            -webkit-font-smoothing: antialiased !important;
            -moz-osx-font-smoothing: grayscale !important;
            display: inline-block !important;
            text-decoration: none !important;
        }
        
        .far {
            font-weight: 400 !important;
        }
        
        .fab {
            font-weight: 400 !important;
            font-family: "Font Awesome 6 Brands", "FontAwesome", "Font Awesome 5 Brands" !important;
        }
        
        /* Fallback icons using Unicode */
        .fa-shield-halved:before, .fas.fa-shield-halved:before { content: "\f3ed" !important; }
        .fa-crown:before, .fas.fa-crown:before { content: "\f521" !important; }
        .fa-users:before, .fas.fa-users:before { content: "\f0c0" !important; }
        .fa-tachometer-alt:before, .fas.fa-tachometer-alt:before { content: "\f3f4" !important; }
        .fa-ticket-alt:before, .fas.fa-ticket-alt:before { content: "\f3ff" !important; }
        .fa-chart-area:before, .fas.fa-chart-area:before { content: "\f1fe" !important; }
        .fa-server:before, .fas.fa-server:before { content: "\f233" !important; }
        .fa-eye:before, .fas.fa-eye:before { content: "\f06e" !important; }
        .fa-tools:before, .fas.fa-tools:before { content: "\f7d9" !important; }
        .fa-cog:before, .fas.fa-cog:before { content: "\f013" !important; }
        .fa-sign-out-alt:before, .fas.fa-sign-out-alt:before { content: "\f2f5" !important; }
        .fa-sync-alt:before, .fas.fa-sync-alt:before { content: "\f2f1" !important; }
        .fa-check-circle:before, .fas.fa-check-circle:before { content: "\f058" !important; }
        .fa-times-circle:before, .fas.fa-times-circle:before { content: "\f057" !important; }
        .fa-info-circle:before, .fas.fa-info-circle:before { content: "\f05a" !important; }
        .fa-calendar:before, .fas.fa-calendar:before { content: "\f133" !important; }
        .fa-edit:before, .fas.fa-edit:before { content: "\f044" !important; }
        .fa-times:before, .fas.fa-times:before { content: "\f00d" !important; }
        .fa-save:before, .fas.fa-save:before { content: "\f0c7" !important; }
        .fa-sun:before, .fas.fa-sun:before { content: "\f185" !important; }
        .fa-moon:before, .fas.fa-moon:before { content: "\f186" !important; }
        .fa-bars:before, .fas.fa-bars:before { content: "\f0c9" !important; }
        .fa-paper-plane:before, .fas.fa-paper-plane:before { content: "\f1d8" !important; }
        .fa-clock:before, .fas.fa-clock:before { content: "\f017" !important; }
        .fa-envelope:before, .fas.fa-envelope:before { content: "\f0e0" !important; }
        .fa-memory:before, .fas.fa-memory:before { content: "\f538" !important; }
        .fa-microchip:before, .fas.fa-microchip:before { content: "\f2db" !important; }
        .fa-database:before, .fas.fa-database:before { content: "\f1c0" !important; }
        .fa-network-wired:before, .fas.fa-network-wired:before { content: "\f6ff" !important; }
        .fa-reply:before, .fas.fa-reply:before { content: "\f3e5" !important; }
        .fa-user-shield:before, .fas.fa-user-shield:before { content: "\f505" !important; }
        .fa-monitor-heartbeat:before, .fas.fa-monitor-heartbeat:before { content: "\f611" !important; }
        .fa-plus:before, .fas.fa-plus:before { content: "\f067" !important; }
        .fa-trash:before, .fas.fa-trash:before { content: "\f1f8" !important; }
        .fa-search:before, .fas.fa-search:before { content: "\f002" !important; }
        .fa-filter:before, .fas.fa-filter:before { content: "\f0b0" !important; }
        .fa-download:before, .fas.fa-download:before { content: "\f019" !important; }
        .fa-chart-line:before, .fas.fa-chart-line:before { content: "\f201" !important; }
        .fa-chart-bar:before, .fas.fa-chart-bar:before { content: "\f080" !important; }
        
        /* Enhanced Vazir Font Loading */
        @import url('https://v1.fontapi.ir/css/Vazir');
        @import url('https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css');
        
        @font-face {
            font-family: 'Vazir-Local';
            src: url('https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/Vazir-Regular.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }
        
        @font-face {
            font-family: 'Vazir-Local';
            src: url('https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/Vazir-Bold.woff2') format('woff2');
            font-weight: bold;
            font-style: normal;
            font-display: swap;
        }

        * {
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /* Force Vazir font loading */
        body, html, div, span, p, h1, h2, h3, h4, h5, h6, button, input, select, textarea, label {
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }

        :root {
            --primary-color: #8B5CF6;
            --primary-light: #A78BFA;
            --primary-dark: #7C3AED;
            --secondary-color: #06B6D4;
            --accent-color: #F59E0B;
            --success-color: #10B981;
            --danger-color: #EF4444;
            --warning-color: #F59E0B;
            --info-color: #3B82F6;
            
            /* Light theme */
            --bg-primary: #FFFFFF;
            --bg-secondary: #F8FAFC;
            --bg-tertiary: #F1F5F9;
            --card-bg: #FFFFFF;
            --text-primary: #1E293B;
            --text-secondary: #64748B;
            --text-muted: #94A3B8;
            --border-color: #E2E8F0;
            --border-light: #F1F5F9;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }

        [data-theme="dark"] {
            --bg-primary: #0F172A;
            --bg-secondary: #1E293B;
            --bg-tertiary: #334155;
            --card-bg: #1E293B;
            --text-primary: #F8FAFC;
            --text-secondary: #CBD5E1;
            --text-muted: #64748B;
            --border-color: #334155;
            --border-light: #475569;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.3);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.3), 0 2px 4px -2px rgb(0 0 0 / 0.3);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.3), 0 4px 6px -4px rgb(0 0 0 / 0.3);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.3), 0 8px 10px -6px rgb(0 0 0 / 0.3);
        }

        body {
            margin: 0;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }
        
        .loading-spinner {
            border: 2px solid transparent;
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-left: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Icon Enhancement */
        i[class*="fa"] {
            font-family: "Font Awesome 6 Free", "Font Awesome 6 Pro", "Font Awesome 6 Brands", "FontAwesome" !important;
            font-style: normal !important;
            font-weight: 900 !important;
            line-height: 1 !important;
            text-rendering: auto !important;
            -webkit-font-smoothing: antialiased !important;
            -moz-osx-font-smoothing: grayscale !important;
            display: inline-block !important;
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 2000;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 50px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 60px;
            justify-content: center;
        }

        .theme-toggle:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .theme-toggle i {
            font-size: 18px;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .theme-toggle .fa-sun {
            color: #f59e0b;
        }

        .theme-toggle .fa-moon {
            color: #8B5CF6;
        }
        
        /* Server URL Setting */
        .server-setting {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 2000;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--text-secondary);
            min-width: 120px;
            justify-content: center;
        }

        .server-setting:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            color: var(--primary-color);
        }

        .server-setting i {
            font-size: 14px;
        }
        
        /* Login Styles */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            padding: 16px;
            position: relative;
        }

        .login-background {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><defs><linearGradient id="a" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:%238B5CF6;stop-opacity:0.1"/><stop offset="100%" style="stop-color:%2306B6D4;stop-opacity:0.1"/></linearGradient></defs><path fill="url(%23a)" d="M0,0 L1000,0 L1000,1000 L0,1000 Z"/><circle cx="200" cy="200" r="100" fill="rgba(255,255,255,0.05)"/><circle cx="800" cy="300" r="150" fill="rgba(255,255,255,0.03)"/><circle cx="300" cy="800" r="120" fill="rgba(255,255,255,0.04)"/></svg>');
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
        }
        
        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 32px;
            border-radius: 24px;
            box-shadow: var(--shadow-xl);
            width: 100%;
            max-width: 400px;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        [data-theme="dark"] .login-card {
            background: rgba(30, 41, 59, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .login-header {
            text-align: center;
            margin-bottom: 32px;
        }
        
        .login-logo {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            border-radius: 16px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: #fff;
            box-shadow: var(--shadow-lg);
        }
        
        .login-title {
            color: var(--text-primary);
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .login-subtitle {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
        }

        .login-footer {
            text-align: center;
            margin-top: 32px;
            padding-top: 20px;
            border-top: 1px solid var(--border-light);
        }

        .login-copyright {
            font-size: 11px;
            color: var(--text-muted);
            line-height: 1.5;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 16px;
            background: var(--card-bg);
            color: var(--text-primary);
            transition: all 0.3s ease;
            outline: none;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }
        
        .form-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.1);
            transform: translateY(-1px);
        }
        
        .form-input::placeholder {
            color: var(--text-muted);
        }
        
        .login-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            color: #fff;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }
        
        .login-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .login-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        
        .error-message, .success-message {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
            text-align: center;
            font-weight: 500;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .success-message {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        
        /* Panel Styles */
        .panel-container {
            display: flex;
            min-height: 100vh;
            background: var(--bg-primary);
            position: relative;
        }
        
        .panel-nav {
            width: 280px;
            background: var(--card-bg);
            border-left: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 24px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1500;
            box-shadow: var(--shadow-lg);
            right: 0;
            top: 0;
            transition: all 0.3s ease;
        }
        
        .nav-header {
            text-align: center;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border-light);
        }
        
        .nav-logo {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            border-radius: 14px;
            margin: 0 auto 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #fff;
            box-shadow: var(--shadow-md);
        }
        
        .nav-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
            color: var(--text-primary);
        }
        
        .nav-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .nav-menu {
            flex: 1;
        }
        
        .nav-item {
            background: none;
            color: var(--text-secondary);
            border: none;
            padding: 14px 16px;
            text-align: right;
            font-size: 14px;
            cursor: pointer;
            border-radius: 12px;
            margin: 3px 0;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
            font-weight: 500;
            direction: rtl;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }
        
        .nav-item i {
            margin-right: 12px;
            width: 18px;
            text-align: center;
            font-size: 16px;
            flex-shrink: 0;
        }
        
        .nav-item:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
            transform: translateX(2px);
        }
        
        .nav-item.active {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            color: #fff;
            box-shadow: var(--shadow-md);
        }
        
        .nav-footer {
            border-top: 1px solid var(--border-light);
            padding-top: 24px;
            text-align: center;
        }
        
        .logout-btn {
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            width: 100%;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }
        
        .logout-btn:hover {
            background: var(--danger-color);
            color: #fff;
            border-color: var(--danger-color);
        }
        
        .panel-content {
            flex: 1;
            padding: 24px;
            background: var(--bg-primary);
            margin-right: 280px;
            min-height: 100vh;
            position: relative;
            z-index: 1;
        }
        
        .content-header {
            color: var(--text-primary);
            font-size: 32px;
            margin-bottom: 32px;
            text-align: center;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }
        
        .content-section {
            display: none;
            background: var(--card-bg);
            padding: 24px;
            border-radius: 16px;
            box-shadow: var(--shadow-md);
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
        }
        
        .content-section.active {
            display: block;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }
        
        .section-title {
            color: var(--text-primary);
            font-size: 22px;
            margin: 0;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            border-radius: 2px;
        }
        
        .refresh-btn {
            background: var(--primary-color);
            color: #fff;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid transparent;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }
        
        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            background: var(--primary-light);
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        
        .stats-card {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 16px;
            box-shadow: var(--shadow-md);
            text-align: center;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stats-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
        }

        .stats-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }
        
        .stats-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            border-radius: 12px;
            margin: 0 auto 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #fff;
            box-shadow: var(--shadow-md);
        }
        
        .stats-number {
            font-size: 28px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 8px;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }
        
        .stats-label {
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }
        
        /* System Cards */
        .system-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        
        .system-card {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 16px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .system-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, var(--secondary-color), var(--accent-color));
        }

        .system-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .system-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--secondary-color), var(--accent-color));
            border-radius: 12px;
            margin: 0 auto 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #fff;
            box-shadow: var(--shadow-md);
        }

        .system-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            text-align: center;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }

        .system-value {
            font-size: 24px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 8px;
            text-align: center;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }

        .system-details {
            color: var(--text-secondary);
            font-size: 12px;
            text-align: center;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }
        
        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 20px;
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
        }
        
        .data-table th,
        .data-table td {
            padding: 16px 12px;
            text-align: right;
            font-size: 14px;
            border-bottom: 1px solid var(--border-light);
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }
        
        .data-table th {
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .data-table tbody tr {
            transition: all 0.2s ease;
        }
        
        .data-table tbody tr:hover {
            background: var(--bg-secondary);
        }

        .data-table tbody tr:last-child td {
            border-bottom: none;
        }
        
        /* Form Styles */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .form-button {
            background: var(--primary-color);
            color: #fff;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 2px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            border: 1px solid transparent;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }
        
        .form-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .form-button.danger {
            background: var(--danger-color);
        }
        
        .form-button.success {
            background: var(--success-color);
        }
        
        .form-button.info {
            background: var(--info-color);
        }
        
        .form-button.warning {
            background: var(--warning-color);
        }

        .form-button.secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-color: var(--border-color);
        }
        
        /* Status Badges */
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }
        
        .status-active {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        
        .status-inactive {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }
        
        .status-pending {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }
        
        .status-answered {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        
        .status-closed {
            background: rgba(107, 114, 128, 0.1);
            color: #6B7280;
            border: 1px solid rgba(107, 114, 128, 0.2);
        }
        
        /* Progress Bar */
        .progress-bar {
            background: var(--border-light);
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            margin: 6px 0;
        }
        
        .progress-fill {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        /* Search Box */
        .search-box {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 14px;
            margin-bottom: 20px;
            background: var(--card-bg);
            color: var(--text-primary);
            transition: all 0.3s ease;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }
        
        .search-box:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.1);
        }

        .search-box::placeholder {
            color: var(--text-muted);
        }
        
        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }
        
        .modal-content {
            background: var(--card-bg);
            padding: 28px;
            border-radius: 16px;
            max-width: 700px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--border-color);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-light);
        }
        
        .modal-title {
            color: var(--text-primary);
            font-size: 20px;
            font-weight: 700;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }
        
        .modal-close {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: var(--danger-color);
            color: #fff;
            border-color: var(--danger-color);
        }
        
        /* Ticket Styles */
        .ticket-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .ticket-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(135deg, var(--info-color), var(--primary-color));
        }

        .ticket-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .ticket-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .ticket-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }

        .ticket-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .ticket-content {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 16px;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }

        .ticket-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
        }

        .ticket-actions {
            display: flex;
            gap: 8px;
        }

        .ticket-form {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 24px;
        }

        .message-input {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            background: var(--card-bg);
            color: var(--text-primary);
            transition: all 0.3s ease;
            resize: vertical;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }

        .message-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.1);
        }

        .message-input::placeholder {
            color: var(--text-muted);
        }

        /* Representative Monitor Styles */
        .monitor-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .monitor-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(135deg, var(--success-color), var(--secondary-color));
        }

        .monitor-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .monitor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .monitor-username {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }

        .monitor-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .monitor-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .monitor-stat {
            text-align: center;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 8px;
            border: 1px solid var(--border-light);
        }

        .monitor-stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }

        .monitor-stat-label {
            font-size: 11px;
            color: var(--text-secondary);
            font-weight: 500;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }
        
        /* Mobile Header */
        .mobile-header {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            width: 100%;
            background: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 12px 16px;
            z-index: 1600;
            font-size: 16px;
            font-weight: 600;
            box-shadow: var(--shadow-sm);
            height: 60px;
            align-items: center;
            justify-content: center;
        }

        .mobile-header-title {
            flex: 1;
            text-align: center;
            font-size: 14px;
            color: var(--text-primary);
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }

        .mobile-header-title i {
            margin-right: 8px;
            color: var(--primary-color);
        }
        
        .mobile-menu-btn {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
            color: var(--text-primary);
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mobile-menu-btn:hover {
            background: var(--primary-color);
            color: #fff;
            border-color: var(--primary-color);
        }
        
        .mobile-nav {
            display: none;
            position: fixed;
            top: 0;
            right: -100%;
            width: 280px;
            height: 100vh;
            background: var(--card-bg);
            transition: right 0.3s ease;
            z-index: 1700;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            border-left: 1px solid var(--border-color);
            padding: 24px;
            flex-direction: column;
        }
        
        .mobile-nav.active {
            right: 0;
        }
        
        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1650;
        }
        
        .mobile-overlay.active {
            display: block;
        }
        
        /* Footer Copyright */
        .footer-copyright {
            margin-top: 40px;
            padding: 20px 0;
            border-top: 1px solid var(--border-light);
            text-align: center;
            color: var(--text-muted);
            font-size: 12px;
            line-height: 1.5;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }
        
        .hidden {
            display: none !important;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 20px;
            border-radius: 12px;
            color: #fff;
            font-weight: 600;
            z-index: 2100;
            animation: slideInRight 0.3s ease;
            max-width: 320px;
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(10px);
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }
        
        .notification.success {
            background: var(--success-color);
        }
        
        .notification.error {
            background: var(--danger-color);
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Chart containers */
        .chart-container {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 16px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
        }

        .chart-title {
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }

        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2200;
        }

        .loading-content {
            background: var(--card-bg);
            padding: 32px;
            border-radius: 16px;
            text-align: center;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--border-color);
        }

        .loading-content .loading-spinner {
            width: 32px;
            height: 32px;
            border-width: 3px;
            margin: 0 auto 16px;
        }

        .loading-text {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 16px;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }

        /* Section Loading Indicator */
        .section-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            color: var(--text-secondary);
            font-size: 16px;
            gap: 12px;
            font-family: 'Vazir', 'Vazir-Local', 'Tahoma', 'Arial', sans-serif !important;
        }

        .section-loading .loading-spinner {
            width: 24px;
            height: 24px;
            border-width: 2px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .theme-toggle {
                top: 70px;
                left: 12px;
                padding: 6px;
                min-width: 44px;
                z-index: 1800;
            }

            .theme-toggle i {
                font-size: 16px;
            }

            .server-setting {
                bottom: 70px;
                left: 12px;
                font-size: 10px;
                padding: 6px;
                min-width: 100px;
            }

            .login-container {
                padding: 12px;
            }

            .login-card {
                padding: 20px;
                border-radius: 16px;
                max-width: calc(100vw - 24px);
            }

            .login-logo {
                width: 48px;
                height: 48px;
                font-size: 20px;
                margin-bottom: 16px;
            }

            .login-title {
                font-size: 18px;
            }

            .login-subtitle {
                font-size: 13px;
            }

            .form-input {
                padding: 12px 14px;
                font-size: 16px;
            }

            .login-btn {
                padding: 14px;
                font-size: 15px;
            }

            /* Mobile Panel Layout */
            .panel-nav {
                display: none !important;
            }
            
            .mobile-header {
                display: flex !important;
            }
            
            .mobile-nav {
                display: flex !important;
            }
            
            .panel-content {
                margin-right: 0 !important;
                padding: 12px;
                padding-top: 75px;
                width: 100vw;
                max-width: 100vw;
                overflow-x: hidden;
            }
            
            .content-header {
                font-size: 20px;
                margin-bottom: 16px;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
            
            .refresh-btn {
                align-self: flex-end;
            }
            
            .stats-grid, .system-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 8px;
                width: 100%;
                max-width: calc(100vw - 24px);
            }

            .stats-card, .system-card {
                padding: 14px;
                min-height: 120px;
                width: 100%;
                box-sizing: border-box;
            }

            .stats-number, .system-value {
                font-size: 18px;
            }

            .stats-icon, .system-icon {
                width: 36px;
                height: 36px;
                font-size: 14px;
                margin-bottom: 8px;
            }

            .stats-label, .system-details {
                font-size: 11px;
            }
            
            .form-grid {
                grid-template-columns: 1fr !important;
                gap: 12px;
                width: 100%;
                max-width: calc(100vw - 24px);
            }

            .content-section {
                padding: 16px;
                margin-bottom: 16px;
                width: 100%;
                max-width: calc(100vw - 24px);
                box-sizing: border-box;
            }

            .section-title {
                font-size: 16px;
                margin-bottom: 16px;
            }

            .section-title::before {
                width: 3px;
                height: 18px;
            }

            .chart-container {
                padding: 16px;
                width: 100%;
                box-sizing: border-box;
            }

            .chart-title {
                font-size: 14px;
                margin-bottom: 12px;
            }
            
            .data-table {
                font-size: 12px;
                width: 100%;
                max-width: calc(100vw - 24px);
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
            
            .data-table th,
            .data-table td {
                padding: 8px 6px;
                min-width: 80px;
            }

            .modal {
                padding: 12px;
            }

            .modal-content {
                padding: 20px;
                max-width: calc(100vw - 24px);
                width: 100%;
            }

            .form-button {
                padding: 8px 12px;
                font-size: 12px;
                margin: 1px;
            }

            .search-box {
                margin-bottom: 12px;
                font-size: 14px;
                padding: 10px 12px;
                width: 100%;
                max-width: calc(100vw - 24px);
                box-sizing: border-box;
            }

            .message-input {
                font-size: 14px;
                padding: 10px 12px;
                min-height: 100px;
            }

            .ticket-card, .monitor-card {
                padding: 16px;
                margin-bottom: 12px;
            }

            .ticket-form {
                padding: 16px;
                margin-bottom: 16px;
            }

            .ticket-header, .monitor-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .ticket-title, .monitor-username {
                font-size: 14px;
            }

            .ticket-meta, .monitor-status {
                font-size: 11px;
            }

            .ticket-content {
                font-size: 13px;
            }

            .ticket-footer {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .ticket-actions {
                width: 100%;
                justify-content: space-between;
            }

            .notification {
                right: 12px;
                top: 75px;
                max-width: calc(100vw - 24px);
            }

            .monitor-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }

            .monitor-stat {
                padding: 8px;
            }

            .monitor-stat-value {
                font-size: 16px;
            }

            .monitor-stat-label {
                font-size: 10px;
            }
        }

        @media (min-width: 769px) {
            .mobile-header {
                display: none !important;
            }
            
            .mobile-nav {
                display: none !important;
            }
            
            .mobile-overlay {
                display: none !important;
            }
        }
        
        @media (max-width: 480px) {
            .stats-grid, .system-grid {
                grid-template-columns: 1fr !important;
                gap: 8px;
                width: 100%;
                max-width: calc(100vw - 24px);
            }
            
            .stats-card, .system-card {
                padding: 12px;
                width: 100%;
                box-sizing: border-box;
            }
            
            .stats-number, .system-value {
                font-size: 16px;
            }

            .stats-icon, .system-icon {
                width: 32px;
                height: 32px;
                font-size: 12px;
            }

            .form-button {
                padding: 6px 10px;
                font-size: 11px;
            }

            .data-table th,
            .data-table td {
                padding: 6px 4px;
                font-size: 11px;
                min-width: 70px;
            }

            .notification {
                max-width: calc(100vw - 20px);
                right: 10px;
                top: 75px;
            }

            .mobile-nav {
                width: calc(100vw - 40px);
                max-width: 260px;
            }

            .mobile-header-title {
                font-size: 13px;
            }

            .content-header {
                font-size: 18px;
            }

            .section-title {
                font-size: 14px;
            }

            .ticket-card, .monitor-card {
                padding: 12px;
            }

            .ticket-form {
                padding: 12px;
            }

            .ticket-title, .monitor-username {
                font-size: 13px;
            }

            .monitor-stats {
                grid-template-columns: 1fr;
                gap: 6px;
            }
        }
    </style>
</head>
<body>
    <!-- Theme Toggle -->
    <div class="theme-toggle" onclick="toggleTheme()">
        <i class="fas fa-sun" id="themeIcon"></i>
    </div>

    <!-- Server URL Setting -->
    <div class="server-setting" onclick="changeServerUrl()">
        <i class="fas fa-server"></i>
        <span>تنظیم سرور</span>
    </div>

    <!-- Login Section -->
    <div id="loginSection" class="login-container">
        <div class="login-background"></div>
        <div class="login-card">
            <div class="login-header">
                <div class="login-logo">👑</div>
                <h1 class="login-title">پنل مدیریت</h1>
                <p class="login-subtitle">طوفان سرور - ادمین</p>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">نام کاربری</label>
                    <input type="text" id="username" class="form-input" placeholder="نام کاربری ادمین" required maxlength="50" pattern="[a-zA-Z0-9_]{3,20}">
                </div>
                
                <div class="form-group">
                    <label class="form-label">رمز عبور</label>
                    <input type="password" id="password" class="form-input" placeholder="رمز عبور ادمین" required maxlength="100">
                </div>
                
                <div id="loginError" class="error-message hidden"></div>
                
                <button type="submit" id="loginBtn" class="login-btn">
                    <span id="loginBtnText">ورود به پنل مدیریت</span>
                    <div id="loginSpinner" class="loading-spinner hidden"></div>
                </button>
            </form>

            <div class="login-footer">
                <div class="login-copyright">
                    پنل مدیریت طوفان سرور - دسترسی محدود به مدیران
                </div>
            </div>
        </div>
    </div>

    <!-- Main Panel Section -->
    <div id="panelSection" class="panel-container hidden">
        <!-- Mobile Header -->
        <div class="mobile-header">
            <div class="mobile-header-title">
                <i class="fas fa-crown"></i>
                پنل مدیریت طوفان سرور
            </div>
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        
        <!-- Mobile Overlay -->
        <div id="mobileOverlay" class="mobile-overlay" onclick="toggleMobileMenu()"></div>
        
        <!-- Mobile Navigation -->
        <div id="mobileNav" class="mobile-nav">
            <div class="nav-header">
                <div class="nav-logo">👑</div>
                <div class="nav-title">پنل مدیریت</div>
                <div class="nav-subtitle" id="navWelcomeMobile">خوش آمدید</div>
            </div>
            
            <div class="nav-menu">
                <button class="nav-item active" onclick="showSection('dashboard'); toggleMobileMenu()">
                    <span>داشبورد</span><i class="fas fa-tachometer-alt"></i>
                </button>
                <button class="nav-item" onclick="showSection('tickets'); toggleMobileMenu()">
                    <span>مدیریت تیکت‌ها</span><i class="fas fa-ticket-alt"></i>
                </button>
                <button class="nav-item" onclick="showSection('system'); toggleMobileMenu()">
                    <span>وضعیت سیستم</span><i class="fas fa-server"></i>
                </button>
                <button class="nav-item" onclick="showSection('monitor'); toggleMobileMenu()">
                    <span>مانیتورینگ نمایندگان</span><i class="fas fa-eye"></i>
                </button>
                <button class="nav-item" onclick="showSection('analytics'); toggleMobileMenu()">
                    <span>آمار و گزارش</span><i class="fas fa-chart-area"></i>
                </button>
                <button class="nav-item" onclick="showSection('admins'); toggleMobileMenu()">
                    <span>مدیریت ادمین‌ها</span><i class="fas fa-user-shield"></i>
                </button>
                <button class="nav-item" onclick="showSection('settings'); toggleMobileMenu()">
                    <span>تنظیمات</span><i class="fas fa-cog"></i>
                </button>
            </div>
            
            <div class="nav-footer">
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> خروج
                </button>
            </div>
        </div>
        
        <!-- Side Navigation -->
        <div class="panel-nav">
            <div class="nav-header">
                <div class="nav-logo">👑</div>
                <div class="nav-title">پنل مدیریت</div>
                <div class="nav-subtitle" id="navWelcome">خوش آمدید</div>
            </div>
            
            <div class="nav-menu">
                <button class="nav-item active" data-section="dashboard" onclick="showSection('dashboard')">
                    <span>داشبورد</span><i class="fas fa-tachometer-alt"></i>
                </button>
                <button class="nav-item" data-section="tickets" onclick="showSection('tickets')">
                    <span>مدیریت تیکت‌ها</span><i class="fas fa-ticket-alt"></i>
                </button>
                <button class="nav-item" data-section="system" onclick="showSection('system')">
                    <span>وضعیت سیستم</span><i class="fas fa-server"></i>
                </button>
                <button class="nav-item" data-section="monitor" onclick="showSection('monitor')">
                    <span>مانیتورینگ نمایندگان</span><i class="fas fa-eye"></i>
                </button>
                <button class="nav-item" data-section="analytics" onclick="showSection('analytics')">
                    <span>آمار و گزارش</span><i class="fas fa-chart-area"></i>
                </button>
                <button class="nav-item" data-section="admins" onclick="showSection('admins')">
                    <span>مدیریت ادمین‌ها</span><i class="fas fa-user-shield"></i>
                </button>
                <button class="nav-item" data-section="settings" onclick="showSection('settings')">
                    <span>تنظیمات</span><i class="fas fa-cog"></i>
                </button>
            </div>
            
            <div class="nav-footer">
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> خروج
                </button>
            </div>
        </div>

        <!-- Content -->
        <div class="panel-content">
            <h1 class="content-header">پنل مدیریت طوفان سرور</h1>
            
            <!-- Dashboard Section -->
            <div id="dashboardSection" class="content-section active">
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fas fa-tachometer-alt"></i>
                        داشبورد مدیریت
                    </h3>
                    <button class="refresh-btn" onclick="refreshDashboard()">
                        <i class="fas fa-sync-alt"></i>
                        بروزرسانی
                    </button>
                </div>
                
                <div class="stats-grid">
                    <div class="stats-card">
                        <div class="stats-icon"><i class="fas fa-users"></i></div>
                        <div class="stats-number" id="totalUsers">0</div>
                        <div class="stats-label">کل کاربران</div>
                    </div>
                    
                    <div class="stats-card">
                        <div class="stats-icon"><i class="fas fa-user-shield"></i></div>
                        <div class="stats-number" id="totalReps">0</div>
                        <div class="stats-label">نمایندگان فعال</div>
                    </div>
                    
                    <div class="stats-card">
                        <div class="stats-icon"><i class="fas fa-ticket-alt"></i></div>
                        <div class="stats-number" id="totalTickets">0</div>
                        <div class="stats-label">تیکت‌های باز</div>
                    </div>
                    
                    <div class="stats-card">
                        <div class="stats-icon"><i class="fas fa-download"></i></div>
                        <div class="stats-number" id="totalTraffic">0 GB</div>
                        <div class="stats-label">ترافیک امروز</div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
                    <div class="chart-container">
                        <h4 class="chart-title">ترافیک روزانه</h4>
                        <canvas id="dailyTrafficChart" width="300" height="200"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <h4 class="chart-title">وضعیت تیکت‌ها</h4>
                        <canvas id="ticketStatusChart" width="300" height="200"></canvas>
                    </div>
                </div>
            </div>

            <!-- Tickets Management Section -->
            <div id="ticketsSection" class="content-section">
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fas fa-ticket-alt"></i>
                        مدیریت تیکت‌ها
                    </h3>
                    <button class="refresh-btn" onclick="refreshTicketsSection()">
                        <i class="fas fa-sync-alt"></i>
                        بروزرسانی
                    </button>
                </div>
                
                <!-- Ticket Filters -->
                <div style="margin-bottom: 24px;">
                    <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                        <input type="text" id="ticketSearch" placeholder="جستجوی تیکت..." class="search-box" style="flex: 1; min-width: 250px;" maxlength="50">
                        <select id="ticketStatusFilter" class="form-input" style="min-width: 150px;">
                            <option value="">همه وضعیت‌ها</option>
                            <option value="pending">در انتظار پاسخ</option>
                            <option value="answered">پاسخ داده شده</option>
                            <option value="closed">بسته شده</option>
                        </select>
                        <button onclick="filterTickets()" class="form-button">
                            <i class="fas fa-filter"></i> فیلتر
                        </button>
                    </div>
                </div>
                
                <!-- Tickets List -->
                <div id="ticketsContent">
                    <div class="section-loading">
                        <div class="loading-spinner"></div>
                        <span>در حال بارگذاری تیکت‌ها...</span>
                    </div>
                </div>
            </div>

            <!-- System Status Section -->
            <div id="systemSection" class="content-section">
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fas fa-server"></i>
                        وضعیت سیستم
                    </h3>
                    <button class="refresh-btn" onclick="refreshSystemSection()">
                        <i class="fas fa-sync-alt"></i>
                        بروزرسانی
                    </button>
                </div>
                
                <div class="system-grid">
                    <div class="system-card">
                        <div class="system-icon"><i class="fas fa-microchip"></i></div>
                        <div class="system-title">مصرف CPU</div>
                        <div class="system-value" id="cpuUsage">0%</div>
                        <div class="system-details">
                            <div class="progress-bar">
                                <div class="progress-fill" id="cpuProgress" style="width: 0%;"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="system-card">
                        <div class="system-icon"><i class="fas fa-memory"></i></div>
                        <div class="system-title">مصرف RAM</div>
                        <div class="system-value" id="ramUsage">0%</div>
                        <div class="system-details">
                            <div class="progress-bar">
                                <div class="progress-fill" id="ramProgress" style="width: 0%;"></div>
                            </div>
                            <small id="ramDetails">0 GB / 0 GB</small>
                        </div>
                    </div>
                    
                    <div class="system-card">
                        <div class="system-icon"><i class="fas fa-database"></i></div>
                        <div class="system-title">فضای دیسک</div>
                        <div class="system-value" id="diskUsage">0%</div>
                        <div class="system-details">
                            <div class="progress-bar">
                                <div class="progress-fill" id="diskProgress" style="width: 0%;"></div>
                            </div>
                            <small id="diskDetails">0 GB / 0 GB</small>
                        </div>
                    </div>
                    
                    <div class="system-card">
                        <div class="system-icon"><i class="fas fa-network-wired"></i></div>
                        <div class="system-title">پهنای باند</div>
                        <div class="system-value" id="bandwidthUsage">0 MB/s</div>
                        <div class="system-details">
                            <small>⬇️ <span id="downloadSpeed">0 MB/s</span></small>
                            <small>⬆️ <span id="uploadSpeed">0 MB/s</span></small>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-top: 32px;">
                    <div class="chart-container">
                        <h4 class="chart-title">نمودار CPU (۲۴ ساعت گذشته)</h4>
                        <canvas id="cpuChart" width="300" height="200"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <h4 class="chart-title">نمودار RAM (۲۴ ساعت گذشته)</h4>
                        <canvas id="ramChart" width="300" height="200"></canvas>
                    </div>
                </div>
            </div>

            <!-- Representatives Monitor Section -->
            <div id="monitorSection" class="content-section">
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fas fa-eye"></i>
                        مانیتورینگ نمایندگان
                    </h3>
                    <button class="refresh-btn" onclick="refreshMonitorSection()">
                        <i class="fas fa-sync-alt"></i>
                        بروزرسانی
                    </button>
                </div>
                
                <!-- Add Representative Monitor -->
                <div class="ticket-form">
                    <h4 style="color: var(--text-primary); font-size: 18px; font-weight: 600; margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-plus"></i>
                        افزودن نماینده به مانیتورینگ
                    </h4>
                    
                    <form id="addMonitorForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">نام نمایشی</label>
                                <input type="text" id="monitorDisplayName" class="form-input" placeholder="نام نمایشی نماینده" required maxlength="50">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">نام کاربری نماینده</label>
                                <input type="text" id="monitorUsername" class="form-input" placeholder="نام کاربری نماینده" required maxlength="50">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">رمز عبور نماینده</label>
                                <input type="password" id="monitorPassword" class="form-input" placeholder="رمز عبور نماینده" required maxlength="100">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">آدرس سرور (اختیاری)</label>
                                <input type="text" id="monitorServerUrl" class="form-input" placeholder="https://admin.example.com:8443">
                            </div>
                        </div>
                        
                        <div id="addMonitorError" class="error-message hidden"></div>
                        <div id="addMonitorSuccess" class="success-message hidden"></div>
                        
                        <button type="submit" class="form-button" style="width: 100%; padding: 14px;">
                            <span id="addMonitorBtnText">
                                <i class="fas fa-plus"></i> افزودن به مانیتورینگ
                            </span>
                            <div id="addMonitorSpinner" class="loading-spinner hidden"></div>
                        </button>
                    </form>
                </div>
                
                <!-- Representatives List -->
                <div id="representativesContent">
                    <div class="section-loading">
                        <div class="loading-spinner"></div>
                        <span>در حال بارگذاری نمایندگان...</span>
                    </div>
                </div>
            </div>

            <!-- Analytics Section -->
            <div id="analyticsSection" class="content-section">
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fas fa-chart-area"></i>
                        آمار و گزارش‌ها
                    </h3>
                    <button class="refresh-btn" onclick="refreshAnalyticsSection()">
                        <i class="fas fa-sync-alt"></i>
                        بروزرسانی
                    </button>
                </div>
                
                <div id="analyticsContent">
                    <div class="section-loading">
                        <div class="loading-spinner"></div>
                        <span>در حال بارگذاری آمار...</span>
                    </div>
                </div>
            </div>

            <!-- Admins Management Section -->
            <div id="adminsSection" class="content-section">
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fas fa-user-shield"></i>
                        مدیریت ادمین‌ها
                    </h3>
                    <button class="refresh-btn" onclick="refreshAdminsSection()">
                        <i class="fas fa-sync-alt"></i>
                        بروزرسانی
                    </button>
                </div>
                
                <!-- Add Admin Form -->
                <div class="ticket-form">
                    <h4 style="color: var(--text-primary); font-size: 18px; font-weight: 600; margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-plus"></i>
                        افزودن ادمین جدید
                    </h4>
                    
                    <form id="addAdminForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">نام کاربری</label>
                                <input type="text" id="newAdminUsername" class="form-input" placeholder="نام کاربری ادمین جدید" required maxlength="50" pattern="[a-zA-Z0-9_]{3,20}">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">رمز عبور</label>
                                <input type="password" id="newAdminPassword" class="form-input" placeholder="رمز عبور ادمین جدید" required maxlength="100">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">نام نمایشی</label>
                                <input type="text" id="newAdminDisplayName" class="form-input" placeholder="نام نمایشی ادمین" required maxlength="50">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">سطح دسترسی</label>
                                <select id="newAdminRole" class="form-input" required>
                                    <option value="admin">ادمین معمولی</option>
                                    <option value="super_admin">سوپر ادمین</option>
                                </select>
                            </div>
                        </div>
                        
                        <div id="addAdminError" class="error-message hidden"></div>
                        <div id="addAdminSuccess" class="success-message hidden"></div>
                        
                        <button type="submit" class="form-button" style="width: 100%; padding: 14px;">
                            <span id="addAdminBtnText">
                                <i class="fas fa-plus"></i> افزودن ادمین
                            </span>
                            <div id="addAdminSpinner" class="loading-spinner hidden"></div>
                        </button>
                    </form>
                </div>
                
                <!-- Admins List -->
                <div id="adminsContent">
                    <div class="section-loading">
                        <div class="loading-spinner"></div>
                        <span>در حال بارگذاری ادمین‌ها...</span>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settingsSection" class="content-section">
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fas fa-cog"></i>
                        تنظیمات سیستم
                    </h3>
                    <button class="refresh-btn" onclick="refreshSettingsSection()">
                        <i class="fas fa-sync-alt"></i>
                        بروزرسانی
                    </button>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <div class="chart-container">
                        <h4 class="chart-title">اطلاعات حساب</h4>
                        <div class="form-group">
                            <label class="form-label">نام کاربری</label>
                            <input type="text" id="settingsUsername" class="form-input" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">وضعیت اتصال</label>
                            <div id="connectionStatus" class="status-badge status-active">
                                <i class="fas fa-check-circle"></i> متصل
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">آدرس سرور</label>
                            <input type="text" id="currentServerUrl" class="form-input" readonly>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <h4 class="chart-title">تنظیمات سیستم</h4>
                        <div class="form-group">
                            <label class="form-label">حداکثر اندازه فایل آپلود (MB)</label>
                            <input type="number" id="maxFileSize" class="form-input" value="100" min="1" max="1000">
                        </div>
                        <div class="form-group">
                            <label class="form-label">زمان انقضای جلسه (دقیقه)</label>
                            <input type="number" id="sessionTimeout" class="form-input" value="1440" min="60" max="10080">
                        </div>
                        <button onclick="saveSettings()" class="form-button" style="width: 100%; padding: 12px;">
                            <i class="fas fa-save"></i> ذخیره تنظیمات
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Footer Copyright -->
            <div class="footer-copyright">
                پنل مدیریت طوفان سرور - دسترسی محدود به مدیران<br>
                © 2024 ToofanVPN Admin Panel. All rights reserved.
            </div>
        </div>
    </div>

    <!-- Ticket Details Modal -->
    <div id="ticketModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-ticket-alt"></i>
                    جزئیات تیکت
                </h3>
                <button class="modal-close" onclick="closeTicketModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="ticketModalContent"></div>
        </div>
    </div>

    <!-- Representative Details Modal -->
    <div id="representativeModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-user-shield"></i>
                    جزئیات نماینده
                </h3>
                <button class="modal-close" onclick="closeRepresentativeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="representativeModalContent"></div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p class="loading-text">منتظر بمانید...</p>
        </div>
    </div>

    <script>
        // Configuration with admin credentials
        const CONFIG = {
            defaultServerUrl: 'https://admin.jozveraygan.xyz:8443',
            maxLoginAttempts: 5,
            sessionTimeout: 24 * 60 * 60 * 1000, // 24 hours
            tokenKey: 'toofan_admin_session',
            serverUrlKey: 'toofan_admin_server_url',
            adminCredentials: {
                admin: 'admin' // Username: admin, Password: admin
            }
        };

        // Security Utilities
        const Security = {
            sanitizeHtml: (str) => {
                if (!str || typeof str !== 'string') return '';
                const temp = document.createElement('div');
                temp.textContent = str;
                return temp.innerHTML.replace(/[<>'"&]/g, (match) => {
                    const escapeMap = {
                        '<': '&lt;',
                        '>': '&gt;',
                        '"': '&quot;',
                        "'": '&#x27;',
                        '&': '&amp;'
                    };
                    return escapeMap[match];
                });
            },
            
            validateInput: (input, type = 'text', options = {}) => {
                if (!input || typeof input !== 'string') return false;
                
                const maxLength = options.maxLength || 1000;
                const minLength = options.minLength || 0;
                if (input.length < minLength || input.length > maxLength) return false;
                
                switch (type) {
                    case 'username':
                        return /^[a-zA-Z0-9_]{3,20}$/.test(input);
                    case 'password':
                        return input.length >= 3 && input.length <= 100;
                    case 'number':
                        return /^[0-9]+(\.[0-9]+)?$/.test(input);
                    case 'email':
                        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(input);
                    case 'url':
                        try {
                            const url = new URL(input);
                            return url.protocol === 'https:';
                        } catch {
                            return false;
                        }
                    default:
                        return !/<script|javascript:|vbscript:|onload|onerror/i.test(input);
                }
            }
        };

        // Global Variables
        let authToken = '';
        let serverUrl = '';
        let currentUsername = '';
        let tickets = [];
        let representatives = [];
        let admins = [];
        let updateInterval;
        let sectionsLoaded = {
            dashboard: false,
            tickets: false,
            system: false,
            monitor: false,
            analytics: false,
            admins: false
        };

        // Chart instances
        let dailyTrafficChartInstance = null;
        let ticketStatusChartInstance = null;
        let cpuChartInstance = null;
        let ramChartInstance = null;

        // Theme Management
        function initTheme() {
            const savedTheme = sessionStorage.getItem('toofan_admin_theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                document.documentElement.setAttribute('data-theme', 'dark');
                const themeIcon = document.getElementById('themeIcon');
                if (themeIcon) themeIcon.className = 'fas fa-moon';
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
                const themeIcon = document.getElementById('themeIcon');
                if (themeIcon) themeIcon.className = 'fas fa-sun';
            }
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            sessionStorage.setItem('toofan_admin_theme', newTheme);
            
            const themeIcon = document.getElementById('themeIcon');
            if (themeIcon) {
                themeIcon.className = newTheme === 'dark' ? 'fas fa-moon' : 'fas fa-sun';
            }
        }

        // Server URL Management
        function getServerUrl() {
            const stored = sessionStorage.getItem(CONFIG.serverUrlKey);
            if (!stored) return CONFIG.defaultServerUrl;
            
            if (Security.validateInput(stored, 'url')) {
                return stored;
            }
            
            sessionStorage.removeItem(CONFIG.serverUrlKey);
            return CONFIG.defaultServerUrl;
        }

        function setServerUrl(url) {
            if (!Security.validateInput(url, 'url')) {
                showNotification('آدرس سرور نامعتبر است', 'error');
                return false;
            }
            
            try {
                const urlObj = new URL(url);
                if (urlObj.protocol !== 'https:') {
                    showNotification('آدرس سرور باید HTTPS باشد', 'error');
                    return false;
                }
                
                sessionStorage.setItem(CONFIG.serverUrlKey, url);
                return true;
            } catch (e) {
                showNotification('فرمت آدرس سرور نامعتبر است', 'error');
                return false;
            }
        }

        function changeServerUrl() {
            const currentUrl = getServerUrl();
            const newUrl = prompt('آدرس سرور جدید را وارد کنید:', currentUrl);
            
            if (!newUrl || newUrl === currentUrl) return;
            
            if (setServerUrl(newUrl)) {
                showNotification('آدرس سرور تغییر کرد! 🔄', 'success');
                if (document.getElementById('currentServerUrl')) {
                    document.getElementById('currentServerUrl').value = newUrl;
                }
                
                if (authToken) {
                    logout();
                    showNotification('لطفاً مجدداً وارد شوید', 'info');
                }
            }
        }

        // Loading Functions
        function showLoading(message = 'منتظر بمانید...') {
            const overlay = document.getElementById('loadingOverlay');
            const text = document.querySelector('.loading-text');
            if (overlay) overlay.classList.remove('hidden');
            if (text) text.textContent = Security.sanitizeHtml(message);
        }

        function hideLoading() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) overlay.classList.add('hidden');
        }

        // Authentication
        async function handleLogin(e) {
            e.preventDefault();
            
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            
            if (!usernameInput || !passwordInput) {
                showMessage('loginError', 'خطا در فرم ورود');
                return;
            }
            
            const username = usernameInput.value.trim();
            const password = passwordInput.value;
            
            if (!Security.validateInput(username, 'username')) {
                showMessage('loginError', 'نام کاربری نامعتبر است');
                return;
            }
            
            if (!Security.validateInput(password, 'password')) {
                showMessage('loginError', 'رمز عبور نامعتبر است');
                return;
            }
            
            // Check admin credentials
            if (CONFIG.adminCredentials[username] && CONFIG.adminCredentials[username] === password) {
                authToken = 'admin_token_' + Date.now();
                currentUsername = username;
                
                sessionStorage.setItem(CONFIG.tokenKey, authToken);
                sessionStorage.setItem('toofan_admin_username', currentUsername);
                sessionStorage.setItem('toofan_admin_login_time', Date.now().toString());
                
                usernameInput.value = '';
                passwordInput.value = '';
                
                showPanel();
                loadDashboardData();
                startAutoUpdate();
                showNotification('ورود موفقیت‌آمیز بود! 🎉', 'success');
            } else {
                showMessage('loginError', 'اطلاعات ورود نامعتبر است');
            }
        }

        function logout() {
            sessionStorage.removeItem(CONFIG.tokenKey);
            sessionStorage.removeItem('toofan_admin_username');
            sessionStorage.removeItem('toofan_admin_login_time');
            
            if (updateInterval) {
                clearInterval(updateInterval);
            }
            
            authToken = '';
            currentUsername = '';
            sectionsLoaded = { dashboard: false, tickets: false, system: false, monitor: false, analytics: false, admins: false };
            
            const forms = document.querySelectorAll('form');
            forms.forEach(form => {
                if (form && form.reset) form.reset();
            });
            
            const panelSection = document.getElementById('panelSection');
            const loginSection = document.getElementById('loginSection');
            
            if (panelSection) panelSection.classList.add('hidden');
            if (loginSection) loginSection.classList.remove('hidden');
            
            showNotification('با موفقیت خارج شدید', 'success');
        }

        function showPanel() {
            const loginSection = document.getElementById('loginSection');
            const panelSection = document.getElementById('panelSection');
            const navWelcome = document.getElementById('navWelcome');
            const navWelcomeMobile = document.getElementById('navWelcomeMobile');
            const settingsUsername = document.getElementById('settingsUsername');
            const currentServerUrl = document.getElementById('currentServerUrl');
            
            if (loginSection) loginSection.classList.add('hidden');
            if (panelSection) panelSection.classList.remove('hidden');
            
            const welcomeText = `خوش آمدید، مدیر ${Security.sanitizeHtml(currentUsername)}`;
            if (navWelcome) navWelcome.textContent = welcomeText;
            if (navWelcomeMobile) navWelcomeMobile.textContent = welcomeText;
            if (settingsUsername) settingsUsername.value = currentUsername;
            if (currentServerUrl) currentServerUrl.value = getServerUrl();
        }

        // Section Management
        function showSection(sectionName) {
            const allowedSections = ['dashboard', 'tickets', 'system', 'monitor', 'analytics', 'admins', 'settings'];
            if (!allowedSections.includes(sectionName)) {
                console.warn('Invalid section name:', sectionName);
                return;
            }
            
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const targetSection = document.getElementById(`${sectionName}Section`);
            if (targetSection) targetSection.classList.add('active');
            
            document.querySelectorAll(`[data-section="${sectionName}"]`).forEach(item => {
                item.classList.add('active');
            });
            
            // Lazy load section data
            switch(sectionName) {
                case 'dashboard':
                    if (!sectionsLoaded.dashboard) {
                        loadDashboardData();
                        sectionsLoaded.dashboard = true;
                    }
                    break;
                case 'tickets':
                    if (!sectionsLoaded.tickets) {
                        loadTickets();
                        sectionsLoaded.tickets = true;
                    }
                    break;
                case 'system':
                    if (!sectionsLoaded.system) {
                        loadSystemStatus();
                        sectionsLoaded.system = true;
                    }
                    break;
                case 'monitor':
                    if (!sectionsLoaded.monitor) {
                        loadRepresentatives();
                        sectionsLoaded.monitor = true;
                    }
                    break;
                case 'analytics':
                    if (!sectionsLoaded.analytics) {
                        loadAnalytics();
                        sectionsLoaded.analytics = true;
                    }
                    break;
                case 'admins':
                    if (!sectionsLoaded.admins) {
                        loadAdmins();
                        sectionsLoaded.admins = true;
                    }
                    break;
            }
        }

        function toggleMobileMenu() {
            const mobileNav = document.getElementById('mobileNav');
            const mobileOverlay = document.getElementById('mobileOverlay');
            
            if (mobileNav && mobileOverlay) {
                mobileNav.classList.toggle('active');
                mobileOverlay.classList.toggle('active');
            }
        }

        // Auto Update
        function startAutoUpdate() {
            updateInterval = setInterval(() => {
                const dashboardSection = document.getElementById('dashboardSection');
                if (dashboardSection && dashboardSection.classList.contains('active')) {
                    loadDashboardData();
                }
                
                const systemSection = document.getElementById('systemSection');
                if (systemSection && systemSection.classList.contains('active')) {
                    loadSystemStatus();
                }
            }, 30000);
        }

        // Dashboard Functions
        async function loadDashboardData() {
            try {
                // Mock data - در محیط واقعی از API دریافت شود
                const dashboardData = {
                    totalUsers: 1250,
                    totalReps: 15,
                    totalTickets: 8,
                    totalTraffic: 2.5 // GB
                };
                
                updateDashboardStats(dashboardData);
                updateDashboardCharts();
                return Promise.resolve();
            } catch (error) {
                console.error('Dashboard loading failed');
                return Promise.reject();
            }
        }

        function updateDashboardStats(data) {
            const totalUsersEl = document.getElementById('totalUsers');
            const totalRepsEl = document.getElementById('totalReps');
            const totalTicketsEl = document.getElementById('totalTickets');
            const totalTrafficEl = document.getElementById('totalTraffic');
            
            if (totalUsersEl) totalUsersEl.textContent = data.totalUsers.toString();
            if (totalRepsEl) totalRepsEl.textContent = data.totalReps.toString();
            if (totalTicketsEl) totalTicketsEl.textContent = data.totalTickets.toString();
            if (totalTrafficEl) totalTrafficEl.textContent = `${data.totalTraffic} GB`;
        }

        function updateDashboardCharts() {
            // Destroy existing charts
            if (dailyTrafficChartInstance) {
                dailyTrafficChartInstance.destroy();
                dailyTrafficChartInstance = null;
            }
            if (ticketStatusChartInstance) {
                ticketStatusChartInstance.destroy();
                ticketStatusChartInstance = null;
            }
            
            // Daily Traffic Chart
            const dailyCanvas = document.getElementById('dailyTrafficChart');
            if (dailyCanvas) {
                const dailyCtx = dailyCanvas.getContext('2d');
                const dailyData = generateDailyTrafficData();
                
                dailyTrafficChartInstance = new Chart(dailyCtx, {
                    type: 'line',
                    data: {
                        labels: dailyData.labels,
                        datasets: [{
                            label: 'ترافیک (GB)',
                            data: dailyData.data,
                            borderColor: '#8B5CF6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: 'var(--border-light)' },
                                ticks: { color: 'var(--text-secondary)' }
                            },
                            x: {
                                grid: { color: 'var(--border-light)' },
                                ticks: { color: 'var(--text-secondary)' }
                            }
                        },
                        plugins: {
                            legend: { labels: { color: 'var(--text-secondary)' } }
                        }
                    }
                });
            }
            
            // Ticket Status Chart
            const ticketCanvas = document.getElementById('ticketStatusChart');
            if (ticketCanvas) {
                const ticketCtx = ticketCanvas.getContext('2d');
                
                ticketStatusChartInstance = new Chart(ticketCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['در انتظار پاسخ', 'پاسخ داده شده', 'بسته شده'],
                        datasets: [{
                            data: [8, 15, 22],
                            backgroundColor: ['#F59E0B', '#10B981', '#6B7280'],
                            borderWidth: 3,
                            borderColor: 'var(--card-bg)',
                            hoverBorderWidth: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { color: 'var(--text-secondary)' }
                            }
                        }
                    }
                });
            }
        }

        function generateDailyTrafficData() {
            const labels = [];
            const data = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('fa-IR', { month: 'short', day: 'numeric' }));
                data.push((Math.random() * 5 + 1).toFixed(2));
            }
            
            return { labels, data };
        }

        // Tickets Management
        async function loadTickets() {
            const ticketsContent = document.getElementById('ticketsContent');
            if (!ticketsContent) return Promise.reject();
            
            try {
                // Mock tickets data
                tickets = [
                    {
                        id: 1,
                        subject: 'مشکل در اتصال VPN',
                        message: 'سلام، کاربران من نمی‌توانند به سرور متصل شوند. لطفاً راهنمایی کنید.',
                        status: 'pending',
                        created_at: new Date(Date.now() - 3600000).toISOString(),
                        created_by: 'نماینده احمد',
                        responses: []
                    },
                    {
                        id: 2,
                        subject: 'درخواست افزایش ترافیک',
                        message: 'سلام، لطفاً ترافیک کاربران من را افزایش دهید.',
                        status: 'answered',
                        created_at: new Date(Date.now() - 86400000).toISOString(),
                        created_by: 'نماینده محمد',
                        responses: [
                            {
                                message: 'سلام، ترافیک شما افزایش یافت.',
                                created_at: new Date(Date.now() - 3600000).toISOString(),
                                is_admin: true,
                                admin_name: 'مدیر سیستم'
                            }
                        ]
                    },
                    {
                        id: 3,
                        subject: 'گزارش باگ در پنل',
                        message: 'سلام، در بخش آمار پنل مشکل هست و اعداد درست نمایش داده نمی‌شود.',
                        status: 'pending',
                        created_at: new Date(Date.now() - 7200000).toISOString(),
                        created_by: 'نماینده علی',
                        responses: []
                    }
                ];
                
                renderTicketsSection();
                return Promise.resolve();
            } catch (error) {
                console.error('Tickets loading failed');
                return Promise.reject();
            }
        }

        function renderTicketsSection() {
            const ticketsContent = document.getElementById('ticketsContent');
            if (!ticketsContent) return;
            
            if (!Array.isArray(tickets) || tickets.length === 0) {
                ticketsContent.innerHTML = `
                    <div style="text-align: center; color: var(--text-muted); padding: 60px; font-style: italic;">
                        <i class="fas fa-ticket-alt" style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;"></i>
                        <p>هیچ تیکتی یافت نشد</p>
                    </div>
                `;
                return;
            }
            
            ticketsContent.innerHTML = '';
            
            tickets.forEach(ticket => {
                const ticketCard = document.createElement('div');
                ticketCard.className = 'ticket-card';
                
                const statusClass = ticket.status === 'pending' ? 'status-pending' :
                                  ticket.status === 'answered' ? 'status-answered' : 'status-closed';
                const statusText = ticket.status === 'pending' ? 'در انتظار پاسخ' :
                                 ticket.status === 'answered' ? 'پاسخ داده شده' : 'بسته شده';
                
                const createdDate = new Date(ticket.created_at).toLocaleDateString('fa-IR', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                ticketCard.innerHTML = `
                    <div class="ticket-header">
                        <h4 class="ticket-title">${Security.sanitizeHtml(ticket.subject)}</h4>
                        <div class="ticket-meta">
                            <span><i class="fas fa-clock"></i> ${createdDate}</span>
                            <span><i class="fas fa-user"></i> ${Security.sanitizeHtml(ticket.created_by)}</span>
                            <span><i class="fas fa-ticket-alt"></i> #${ticket.id}</span>
                        </div>
                    </div>
                    
                    <div class="ticket-content">${Security.sanitizeHtml(ticket.message)}</div>
                    
                    <div class="ticket-footer">
                        <span class="status-badge ${statusClass}">${statusText}</span>
                        <div class="ticket-actions">
                            <button onclick="showTicketDetails(${ticket.id})" class="form-button info">
                                <i class="fas fa-eye"></i> مشاهده
                            </button>
                            <button onclick="replyToTicket(${ticket.id})" class="form-button success">
                                <i class="fas fa-reply"></i> پاسخ
                            </button>
                            <button onclick="closeTicket(${ticket.id})" class="form-button danger">
                                <i class="fas fa-times"></i> بستن
                            </button>
                        </div>
                    </div>
                `;
                
                ticketsContent.appendChild(ticketCard);
            });
        }

        function showTicketDetails(ticketId) {
            const ticket = tickets.find(t => t.id === ticketId);
            if (!ticket) return;
            
            const ticketModalContent = document.getElementById('ticketModalContent');
            if (!ticketModalContent) return;
            
            const createdDate = new Date(ticket.created_at).toLocaleDateString('fa-IR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            const statusClass = ticket.status === 'pending' ? 'status-pending' :
                              ticket.status === 'answered' ? 'status-answered' : 'status-closed';
            const statusText = ticket.status === 'pending' ? 'در انتظار پاسخ' :
                             ticket.status === 'answered' ? 'پاسخ داده شده' : 'بسته شده';
            
            let responsesHtml = '';
            if (ticket.responses && ticket.responses.length > 0) {
                responsesHtml = '<div style="margin-top: 24px;"><h5 style="color: var(--text-primary); margin-bottom: 16px;">پاسخ‌ها:</h5>';
                ticket.responses.forEach(response => {
                    const responseDate = new Date(response.created_at).toLocaleDateString('fa-IR', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    const responseLabel = response.is_admin ? response.admin_name || 'پشتیبانی' : ticket.created_by;
                    
                    responsesHtml += `
                        <div style="background: var(--bg-secondary); padding: 16px; border-radius: 12px; margin-bottom: 12px; border-right: 4px solid ${response.is_admin ? 'var(--success-color)' : 'var(--primary-color)'};">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <strong style="color: var(--text-primary);">${Security.sanitizeHtml(responseLabel)}</strong>
                                <small style="color: var(--text-muted);">${responseDate}</small>
                            </div>
                            <p style="color: var(--text-secondary); margin: 0; line-height: 1.6;">${Security.sanitizeHtml(response.message)}</p>
                        </div>
                    `;
                });
                responsesHtml += '</div>';
            }
            
            // Reply form
            const replyFormHtml = `
                <div style="margin-top: 24px; border-top: 1px solid var(--border-light); padding-top: 24px;">
                    <h5 style="color: var(--text-primary); margin-bottom: 16px;">پاسخ جدید:</h5>
                    <form id="replyForm" onsubmit="submitTicketReply(event, ${ticketId})">
                        <textarea id="replyMessage" class="message-input" placeholder="پاسخ خود را اینجا بنویسید..." required maxlength="2000"></textarea>
                        <div style="display: flex; gap: 12px; margin-top: 16px;">
                            <button type="submit" class="form-button success" style="flex: 1;">
                                <i class="fas fa-paper-plane"></i> ارسال پاسخ
                            </button>
                            <button type="button" onclick="closeTicketFromModal(${ticketId})" class="form-button danger">
                                <i class="fas fa-times"></i> بستن تیکت
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            ticketModalContent.innerHTML = `
                <div style="margin-bottom: 24px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-wrap: wrap; gap: 12px;">
                        <div>
                            <h4 style="color: var(--text-primary); margin: 0; font-size: 18px;">${Security.sanitizeHtml(ticket.subject)}</h4>
                            <small style="color: var(--text-muted);">تیکت #${ticket.id} • ${createdDate} • توسط ${Security.sanitizeHtml(ticket.created_by)}</small>
                        </div>
                        <span class="status-badge ${statusClass}">${statusText}</span>
                    </div>
                    
                    <div style="background: var(--bg-secondary); padding: 20px; border-radius: 12px; border: 1px solid var(--border-light);">
                        <h5 style="color: var(--text-primary); margin-bottom: 12px;">پیام اصلی:</h5>
                        <p style="color: var(--text-secondary); margin: 0; line-height: 1.6;">${Security.sanitizeHtml(ticket.message)}</p>
                    </div>
                    
                    ${responsesHtml}
                    ${ticket.status !== 'closed' ? replyFormHtml : ''}
                </div>
            `;
            
            const ticketModal = document.getElementById('ticketModal');
            if (ticketModal) ticketModal.classList.remove('hidden');
        }

        function closeTicketModal() {
            const ticketModal = document.getElementById('ticketModal');
            if (ticketModal) ticketModal.classList.add('hidden');
        }

        function replyToTicket(ticketId) {
            showTicketDetails(ticketId);
        }

        async function submitTicketReply(e, ticketId) {
            e.preventDefault();
            
            const replyMessage = document.getElementById('replyMessage');
            if (!replyMessage) return;
            
            const message = replyMessage.value.trim();
            if (!Security.validateInput(message, 'text', { minLength: 10, maxLength: 2000 })) {
                showNotification('پیام باید بین 10 تا 2000 کاراکتر باشد', 'error');
                return;
            }
            
            try {
                const ticket = tickets.find(t => t.id === ticketId);
                if (ticket) {
                    const newResponse = {
                        message: message,
                        created_at: new Date().toISOString(),
                        is_admin: true,
                        admin_name: `مدیر ${currentUsername}`
                    };
                    
                    ticket.responses = ticket.responses || [];
                    ticket.responses.push(newResponse);
                    ticket.status = 'answered';
                    
                    replyMessage.value = '';
                    showNotification('پاسخ ارسال شد', 'success');
                    showTicketDetails(ticketId); // Refresh modal
                    renderTicketsSection(); // Refresh list
                }
            } catch (error) {
                showNotification('خطا در ارسال پاسخ', 'error');
            }
        }

        function closeTicket(ticketId) {
            if (confirm('آیا مطمئن هستید که می‌خواهید این تیکت را ببندید؟')) {
                const ticket = tickets.find(t => t.id === ticketId);
                if (ticket) {
                    ticket.status = 'closed';
                    renderTicketsSection();
                    showNotification('تیکت بسته شد', 'success');
                }
            }
        }

        function closeTicketFromModal(ticketId) {
            if (confirm('آیا مطمئن هستید که می‌خواهید این تیکت را ببندید؟')) {
                closeTicket(ticketId);
                closeTicketModal();
            }
        }

        function filterTickets() {
            const searchTerm = document.getElementById('ticketSearch')?.value.toLowerCase() || '';
            const statusFilter = document.getElementById('ticketStatusFilter')?.value || '';
            
            let filteredTickets = tickets;
            
            if (searchTerm) {
                filteredTickets = filteredTickets.filter(ticket => 
                    ticket.subject.toLowerCase().includes(searchTerm) ||
                    ticket.message.toLowerCase().includes(searchTerm) ||
                    ticket.created_by.toLowerCase().includes(searchTerm)
                );
            }
            
            if (statusFilter) {
                filteredTickets = filteredTickets.filter(ticket => ticket.status === statusFilter);
            }
            
            // Render filtered tickets
            const ticketsContent = document.getElementById('ticketsContent');
            if (ticketsContent) {
                const originalTickets = tickets;
                tickets = filteredTickets;
                renderTicketsSection();
                tickets = originalTickets;
            }
        }

        // System Status
        async function loadSystemStatus() {
            try {
                // Mock system data
                const systemData = {
                    cpu: { usage: 45, details: '4 cores @ 2.4GHz' },
                    ram: { usage: 68, used: 5.4, total: 8 },
                    disk: { usage: 35, used: 175, total: 500 },
                    bandwidth: { total: 2.5, download: 1.8, upload: 0.7 }
                };
                
                updateSystemStats(systemData);
                updateSystemCharts();
                return Promise.resolve();
            } catch (error) {
                console.error('System status loading failed');
                return Promise.reject();
            }
        }

        function updateSystemStats(data) {
            // CPU
            const cpuUsage = document.getElementById('cpuUsage');
            const cpuProgress = document.getElementById('cpuProgress');
            if (cpuUsage) cpuUsage.textContent = `${data.cpu.usage}%`;
            if (cpuProgress) cpuProgress.style.width = `${data.cpu.usage}%`;
            
            // RAM
            const ramUsage = document.getElementById('ramUsage');
            const ramProgress = document.getElementById('ramProgress');
            const ramDetails = document.getElementById('ramDetails');
            if (ramUsage) ramUsage.textContent = `${data.ram.usage}%`;
            if (ramProgress) ramProgress.style.width = `${data.ram.usage}%`;
            if (ramDetails) ramDetails.textContent = `${data.ram.used} GB / ${data.ram.total} GB`;
            
            // Disk
            const diskUsage = document.getElementById('diskUsage');
            const diskProgress = document.getElementById('diskProgress');
            const diskDetails = document.getElementById('diskDetails');
            if (diskUsage) diskUsage.textContent = `${data.disk.usage}%`;
            if (diskProgress) diskProgress.style.width = `${data.disk.usage}%`;
            if (diskDetails) diskDetails.textContent = `${data.disk.used} GB / ${data.disk.total} GB`;
            
            // Bandwidth
            const bandwidthUsage = document.getElementById('bandwidthUsage');
            const downloadSpeed = document.getElementById('downloadSpeed');
            const uploadSpeed = document.getElementById('uploadSpeed');
            if (bandwidthUsage) bandwidthUsage.textContent = `${data.bandwidth.total} MB/s`;
            if (downloadSpeed) downloadSpeed.textContent = `${data.bandwidth.download} MB/s`;
            if (uploadSpeed) uploadSpeed.textContent = `${data.bandwidth.upload} MB/s`;
        }

        function updateSystemCharts() {
            // Destroy existing charts
            if (cpuChartInstance) {
                cpuChartInstance.destroy();
                cpuChartInstance = null;
            }
            if (ramChartInstance) {
                ramChartInstance.destroy();
                ramChartInstance = null;
            }
            
            // Generate 24 hour data
            const hours = [];
            const cpuData = [];
            const ramData = [];
            
            for (let i = 23; i >= 0; i--) {
                const hour = new Date();
                hour.setHours(hour.getHours() - i);
                hours.push(hour.getHours() + ':00');
                cpuData.push((Math.random() * 40 + 20).toFixed(1));
                ramData.push((Math.random() * 30 + 50).toFixed(1));
            }
            
            // CPU Chart
            const cpuCanvas = document.getElementById('cpuChart');
            if (cpuCanvas) {
                const cpuCtx = cpuCanvas.getContext('2d');
                cpuChartInstance = new Chart(cpuCtx, {
                    type: 'line',
                    data: {
                        labels: hours,
                        datasets: [{
                            label: 'CPU (%)',
                            data: cpuData,
                            borderColor: '#06B6D4',
                            backgroundColor: 'rgba(6, 182, 212, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                grid: { color: 'var(--border-light)' },
                                ticks: { color: 'var(--text-secondary)' }
                            },
                            x: {
                                grid: { color: 'var(--border-light)' },
                                ticks: { color: 'var(--text-secondary)' }
                            }
                        },
                        plugins: {
                            legend: { labels: { color: 'var(--text-secondary)' } }
                        }
                    }
                });
            }
            
            // RAM Chart
            const ramCanvas = document.getElementById('ramChart');
            if (ramCanvas) {
                const ramCtx = ramCanvas.getContext('2d');
                ramChartInstance = new Chart(ramCtx, {
                    type: 'line',
                    data: {
                        labels: hours,
                        datasets: [{
                            label: 'RAM (%)',
                            data: ramData,
                            borderColor: '#F59E0B',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                grid: { color: 'var(--border-light)' },
                                ticks: { color: 'var(--text-secondary)' }
                            },
                            x: {
                                grid: { color: 'var(--border-light)' },
                                ticks: { color: 'var(--text-secondary)' }
                            }
                        },
                        plugins: {
                            legend: { labels: { color: 'var(--text-secondary)' } }
                        }
                    }
                });
            }
        }

        // Representatives Monitor
        async function loadRepresentatives() {
            const representativesContent = document.getElementById('representativesContent');
            if (!representativesContent) return Promise.reject();
            
            try {
                // Load from localStorage
                const storedReps = localStorage.getItem('toofan_monitored_representatives');
                representatives = storedReps ? JSON.parse(storedReps) : [];
                
                renderRepresentativesSection();
                return Promise.resolve();
            } catch (error) {
                console.error('Representatives loading failed');
                return Promise.reject();
            }
        }

        function renderRepresentativesSection() {
            const representativesContent = document.getElementById('representativesContent');
            if (!representativesContent) return;
            
            if (!Array.isArray(representatives) || representatives.length === 0) {
                representativesContent.innerHTML = `
                    <div style="text-align: center; color: var(--text-muted); padding: 60px; font-style: italic;">
                        <i class="fas fa-eye" style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;"></i>
                        <p>هیچ نماینده‌ای در حال مانیتورینگ نیست</p>
                        <p style="font-size: 12px; margin-top: 8px;">از فرم بالا برای افزودن نماینده استفاده کنید</p>
                    </div>
                `;
                return;
            }
            
            representativesContent.innerHTML = '';
            
            representatives.forEach((rep, index) => {
                const monitorCard = document.createElement('div');
                monitorCard.className = 'monitor-card';
                
                const lastUpdate = rep.lastUpdate ? new Date(rep.lastUpdate).toLocaleDateString('fa-IR', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }) : 'هرگز';
                
                const statusColor = rep.status === 'online' ? 'var(--success-color)' : 
                                   rep.status === 'offline' ? 'var(--danger-color)' : 'var(--warning-color)';
                const statusText = rep.status === 'online' ? 'آنلاین' : 
                                  rep.status === 'offline' ? 'آفلاین' : 'نامشخص';
                
                monitorCard.innerHTML = `
                    <div class="monitor-header">
                        <h4 class="monitor-username">${Security.sanitizeHtml(rep.displayName)}</h4>
                        <div class="monitor-status">
                            <span style="color: ${statusColor}; font-weight: 600;">
                                <i class="fas fa-circle" style="font-size: 8px;"></i> ${statusText}
                            </span>
                            <span><i class="fas fa-clock"></i> ${lastUpdate}</span>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 16px; color: var(--text-secondary); font-size: 13px;">
                        <strong>نام کاربری:</strong> ${Security.sanitizeHtml(rep.username)}<br>
                        <strong>سرور:</strong> ${Security.sanitizeHtml(rep.serverUrl || 'پیش‌فرض')}
                    </div>
                    
                    <div class="monitor-stats">
                        <div class="monitor-stat">
                            <div class="monitor-stat-value">${rep.stats?.totalUsers || 0}</div>
                            <div class="monitor-stat-label">کل کاربران</div>
                        </div>
                        <div class="monitor-stat">
                            <div class="monitor-stat-value">${rep.stats?.activeUsers || 0}</div>
                            <div class="monitor-stat-label">کاربران فعال</div>
                        </div>
                        <div class="monitor-stat">
                            <div class="monitor-stat-value">${rep.stats?.totalTraffic || '0 GB'}</div>
                            <div class="monitor-stat-label">کل ترافیک</div>
                        </div>
                        <div class="monitor-stat">
                            <div class="monitor-stat-value">${rep.stats?.dailyTraffic || '0 GB'}</div>
                            <div class="monitor-stat-label">ترافیک امروز</div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 8px; margin-top: 16px; justify-content: center;">
                        <button onclick="updateRepresentativeStats(${index})" class="form-button info">
                            <i class="fas fa-sync-alt"></i> بروزرسانی
                        </button>
                        <button onclick="showRepresentativeDetails(${index})" class="form-button success">
                            <i class="fas fa-eye"></i> جزئیات
                        </button>
                        <button onclick="removeRepresentative(${index})" class="form-button danger">
                            <i class="fas fa-trash"></i> حذف
                        </button>
                    </div>
                `;
                
                representativesContent.appendChild(monitorCard);
            });
        }

        async function handleAddMonitor(e) {
            e.preventDefault();
            
            const displayNameInput = document.getElementById('monitorDisplayName');
            const usernameInput = document.getElementById('monitorUsername');
            const passwordInput = document.getElementById('monitorPassword');
            const serverUrlInput = document.getElementById('monitorServerUrl');
            
            if (!displayNameInput || !usernameInput || !passwordInput) {
                showMessage('addMonitorError', 'خطا در فرم افزودن نماینده');
                return;
            }
            
            const displayName = displayNameInput.value.trim();
            const username = usernameInput.value.trim();
            const password = passwordInput.value;
            const serverUrl = serverUrlInput.value.trim() || getServerUrl();
            
            if (!Security.validateInput(displayName, 'text', { minLength: 2, maxLength: 50 })) {
                showMessage('addMonitorError', 'نام نمایشی نامعتبر است');
                return;
            }
            
            if (!Security.validateInput(username, 'username')) {
                showMessage('addMonitorError', 'نام کاربری نامعتبر است');
                return;
            }
            
            if (!Security.validateInput(password, 'password')) {
                showMessage('addMonitorError', 'رمز عبور نامعتبر است');
                return;
            }
            
            if (serverUrl && !Security.validateInput(serverUrl, 'url')) {
                showMessage('addMonitorError', 'آدرس سرور نامعتبر است');
                return;
            }
            
            // Check if already exists
            if (representatives.some(rep => rep.username === username && rep.serverUrl === serverUrl)) {
                showMessage('addMonitorError', 'این نماینده قبلاً اضافه شده است');
                return;
            }
            
            setLoadingState('addMonitorForm', 'addMonitorBtnText', 'addMonitorSpinner', true);
            hideMessage('addMonitorError');
            hideMessage('addMonitorSuccess');
            
            try {
                // Mock authentication check
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const newRepresentative = {
                    displayName,
                    username,
                    password, // در محیط واقعی این رمز باید رمزگذاری شود
                    serverUrl,
                    status: 'unknown',
                    lastUpdate: null,
                    stats: {
                        totalUsers: 0,
                        activeUsers: 0,
                        totalTraffic: '0 GB',
                        dailyTraffic: '0 GB'
                    }
                };
                
                representatives.push(newRepresentative);
                
                // Save to localStorage
                localStorage.setItem('toofan_monitored_representatives', JSON.stringify(representatives));
                
                // Clear form
                displayNameInput.value = '';
                usernameInput.value = '';
                passwordInput.value = '';
                serverUrlInput.value = '';
                
                showMessage('addMonitorSuccess', `نماینده ${Security.sanitizeHtml(displayName)} با موفقیت اضافه شد`);
                renderRepresentativesSection();
                showNotification(`نماینده ${Security.sanitizeHtml(displayName)} اضافه شد`, 'success');
                
                // Try to get initial stats
                setTimeout(() => {
                    updateRepresentativeStats(representatives.length - 1);
                }, 1000);
                
            } catch (error) {
                showMessage('addMonitorError', 'خطا در افزودن نماینده');
            }
            
            setLoadingState('addMonitorForm', 'addMonitorBtnText', 'addMonitorSpinner', false);
        }

        async function updateRepresentativeStats(index) {
            if (!representatives[index]) return;
            
            const rep = representatives[index];
            showLoading('در حال بروزرسانی آمار...');
            
            try {
                // Mock API call to representative's server
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Mock data
                rep.stats = {
                    totalUsers: Math.floor(Math.random() * 100) + 20,
                    activeUsers: Math.floor(Math.random() * 80) + 10,
                    totalTraffic: (Math.random() * 500 + 100).toFixed(1) + ' GB',
                    dailyTraffic: (Math.random() * 10 + 1).toFixed(2) + ' GB'
                };
                rep.status = Math.random() > 0.8 ? 'offline' : 'online';
                rep.lastUpdate = new Date().toISOString();
                
                // Save to localStorage
                localStorage.setItem('toofan_monitored_representatives', JSON.stringify(representatives));
                
                renderRepresentativesSection();
                showNotification(`آمار ${Security.sanitizeHtml(rep.displayName)} بروزرسانی شد`, 'success');
                
            } catch (error) {
                showNotification('خطا در بروزرسانی آمار', 'error');
            }
            
            hideLoading();
        }

        function showRepresentativeDetails(index) {
            const rep = representatives[index];
            if (!rep) return;
            
            const representativeModalContent = document.getElementById('representativeModalContent');
            if (!representativeModalContent) return;
            
            const lastUpdate = rep.lastUpdate ? new Date(rep.lastUpdate).toLocaleDateString('fa-IR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            }) : 'هرگز';
            
            const statusColor = rep.status === 'online' ? 'var(--success-color)' : 
                               rep.status === 'offline' ? 'var(--danger-color)' : 'var(--warning-color)';
            const statusText = rep.status === 'online' ? 'آنلاین' : 
                              rep.status === 'offline' ? 'آفلاین' : 'نامشخص';
            
            representativeModalContent.innerHTML = `
                <div style="margin-bottom: 24px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 12px;">
                        <div>
                            <h4 style="color: var(--text-primary); margin: 0; font-size: 20px;">${Security.sanitizeHtml(rep.displayName)}</h4>
                            <small style="color: var(--text-muted);">نام کاربری: ${Security.sanitizeHtml(rep.username)}</small>
                        </div>
                        <span style="color: ${statusColor}; font-weight: 600; font-size: 14px;">
                            <i class="fas fa-circle" style="font-size: 10px;"></i> ${statusText}
                        </span>
                    </div>
                    
                    <div style="background: var(--bg-secondary); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                        <h5 style="color: var(--text-primary); margin-bottom: 16px;">اطلاعات اتصال:</h5>
                        <div style="display: grid; gap: 12px;">
                            <div><strong>سرور:</strong> ${Security.sanitizeHtml(rep.serverUrl)}</div>
                            <div><strong>آخرین بروزرسانی:</strong> ${lastUpdate}</div>
                        </div>
                    </div>
                    
                    <div style="background: var(--bg-secondary); padding: 20px; border-radius: 12px;">
                        <h5 style="color: var(--text-primary); margin-bottom: 16px;">آمار عملکرد:</h5>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                            <div style="text-align: center; padding: 12px; background: var(--card-bg); border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: 700; color: var(--text-primary);">${rep.stats?.totalUsers || 0}</div>
                                <div style="font-size: 12px; color: var(--text-secondary);">کل کاربران</div>
                            </div>
                            <div style="text-align: center; padding: 12px; background: var(--card-bg); border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: 700; color: var(--text-primary);">${rep.stats?.activeUsers || 0}</div>
                                <div style="font-size: 12px; color: var(--text-secondary);">کاربران فعال</div>
                            </div>
                            <div style="text-align: center; padding: 12px; background: var(--card-bg); border-radius: 8px;">
                                <div style="font-size: 18px; font-weight: 700; color: var(--text-primary);">${rep.stats?.totalTraffic || '0 GB'}</div>
                                <div style="font-size: 12px; color: var(--text-secondary);">کل ترافیک</div>
                            </div>
                            <div style="text-align: center; padding: 12px; background: var(--card-bg); border-radius: 8px;">
                                <div style="font-size: 18px; font-weight: 700; color: var(--text-primary);">${rep.stats?.dailyTraffic || '0 GB'}</div>
                                <div style="font-size: 12px; color: var(--text-secondary);">ترافیک امروز</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 12px; margin-top: 24px; justify-content: center;">
                        <button onclick="updateRepresentativeStats(${index}); closeRepresentativeModal();" class="form-button info">
                            <i class="fas fa-sync-alt"></i> بروزرسانی
                        </button>
                        <button onclick="removeRepresentative(${index}); closeRepresentativeModal();" class="form-button danger">
                            <i class="fas fa-trash"></i> حذف از مانیتورینگ
                        </button>
                    </div>
                </div>
            `;
            
            const representativeModal = document.getElementById('representativeModal');
            if (representativeModal) representativeModal.classList.remove('hidden');
        }

        function closeRepresentativeModal() {
            const representativeModal = document.getElementById('representativeModal');
            if (representativeModal) representativeModal.classList.add('hidden');
        }

        function removeRepresentative(index) {
            if (!representatives[index]) return;
            
            if (confirm(`آیا مطمئن هستید که می‌خواهید ${representatives[index].displayName} را از مانیتورینگ حذف کنید؟`)) {
                const removedRep = representatives.splice(index, 1)[0];
                localStorage.setItem('toofan_monitored_representatives', JSON.stringify(representatives));
                renderRepresentativesSection();
                showNotification(`${Security.sanitizeHtml(removedRep.displayName)} از مانیتورینگ حذف شد`, 'success');
            }
        }

        // Analytics
        async function loadAnalytics() {
            const analyticsContent = document.getElementById('analyticsContent');
            if (!analyticsContent) return Promise.reject();
            
            try {
                analyticsContent.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
                        <div class="chart-container">
                            <h4 class="chart-title">آمار کاربران در ۳۰ روز گذشته</h4>
                            <canvas id="userGrowthChart" width="300" height="200"></canvas>
                        </div>
                        
                        <div class="chart-container">
                            <h4 class="chart-title">توزیع ترافیک نمایندگان</h4>
                            <canvas id="repTrafficChart" width="300" height="200"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <h4 class="chart-title">گزارش عملکرد سیستم</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                            <div style="text-align: center; padding: 20px; background: var(--bg-secondary); border-radius: 12px;">
                                <div style="font-size: 32px; font-weight: 800; color: var(--success-color); margin-bottom: 8px;">99.9%</div>
                                <div style="color: var(--text-secondary); font-size: 14px;">آپتایم سیستم</div>
                            </div>
                            <div style="text-align: center; padding: 20px; background: var(--bg-secondary); border-radius: 12px;">
                                <div style="font-size: 32px; font-weight: 800; color: var(--info-color); margin-bottom: 8px;">142ms</div>
                                <div style="color: var(--text-secondary); font-size: 14px;">میانگین پاسخ</div>
                            </div>
                            <div style="text-align: center; padding: 20px; background: var(--bg-secondary); border-radius: 12px;">
                                <div style="font-size: 32px; font-weight: 800; color: var(--warning-color); margin-bottom: 8px;">1.2TB</div>
                                <div style="color: var(--text-secondary); font-size: 14px;">ترافیک ماهانه</div>
                            </div>
                            <div style="text-align: center; padding: 20px; background: var(--bg-secondary); border-radius: 12px;">
                                <div style="font-size: 32px; font-weight: 800; color: var(--primary-color); margin-bottom: 8px;">15</div>
                                <div style="color: var(--text-secondary); font-size: 14px;">نمایندگان فعال</div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Generate charts
                setTimeout(() => {
                    generateAnalyticsCharts();
                }, 100);
                
                return Promise.resolve();
            } catch (error) {
                console.error('Analytics loading failed');
                return Promise.reject();
            }
        }

        function generateAnalyticsCharts() {
            // User Growth Chart
            const userGrowthCanvas = document.getElementById('userGrowthChart');
            if (userGrowthCanvas) {
                const userGrowthCtx = userGrowthCanvas.getContext('2d');
                
                const days = [];
                const userData = [];
                for (let i = 29; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    days.push(date.getDate());
                    userData.push(Math.floor(Math.random() * 50) + 1000 + i * 2);
                }
                
                new Chart(userGrowthCtx, {
                    type: 'line',
                    data: {
                        labels: days,
                        datasets: [{
                            label: 'تعداد کاربران',
                            data: userData,
                            borderColor: '#8B5CF6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: false,
                                grid: { color: 'var(--border-light)' },
                                ticks: { color: 'var(--text-secondary)' }
                            },
                            x: {
                                grid: { color: 'var(--border-light)' },
                                ticks: { color: 'var(--text-secondary)' }
                            }
                        },
                        plugins: {
                            legend: { labels: { color: 'var(--text-secondary)' } }
                        }
                    }
                });
            }
            
            // Representative Traffic Chart
            const repTrafficCanvas = document.getElementById('repTrafficChart');
            if (repTrafficCanvas) {
                const repTrafficCtx = repTrafficCanvas.getContext('2d');
                
                const repNames = representatives.slice(0, 5).map(rep => rep.displayName);
                const repTraffic = representatives.slice(0, 5).map(() => Math.floor(Math.random() * 100) + 20);
                
                // Add some mock data if no representatives
                if (repNames.length === 0) {
                    repNames.push('نماینده 1', 'نماینده 2', 'نماینده 3', 'نماینده 4', 'نماینده 5');
                    repTraffic.push(85, 72, 64, 53, 41);
                }
                
                new Chart(repTrafficCtx, {
                    type: 'bar',
                    data: {
                        labels: repNames,
                        datasets: [{
                            label: 'ترافیک (GB)',
                            data: repTraffic,
                            backgroundColor: [
                                '#8B5CF6',
                                '#06B6D4',
                                '#F59E0B',
                                '#10B981',
                                '#EF4444'
                            ],
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: 'var(--border-light)' },
                                ticks: { color: 'var(--text-secondary)' }
                            },
                            x: {
                                grid: { color: 'var(--border-light)' },
                                ticks: { color: 'var(--text-secondary)' }
                            }
                        },
                        plugins: {
                            legend: { labels: { color: 'var(--text-secondary)' } }
                        }
                    }
                });
            }
        }

        // Admins Management
        async function loadAdmins() {
            const adminsContent = document.getElementById('adminsContent');
            if (!adminsContent) return Promise.reject();
            
            try {
                // Load from localStorage
                const storedAdmins = localStorage.getItem('toofan_admin_users');
                admins = storedAdmins ? JSON.parse(storedAdmins) : [
                    {
                        id: 1,
                        username: 'admin',
                        displayName: 'مدیر اصلی',
                        role: 'super_admin',
                        created_at: new Date().toISOString(),
                        last_login: new Date().toISOString(),
                        status: 'active'
                    }
                ];
                
                renderAdminsSection();
                return Promise.resolve();
            } catch (error) {
                console.error('Admins loading failed');
                return Promise.reject();
            }
        }

        function renderAdminsSection() {
            const adminsContent = document.getElementById('adminsContent');
            if (!adminsContent) return;
            
            if (!Array.isArray(admins) || admins.length === 0) {
                adminsContent.innerHTML = `
                    <div style="text-align: center; color: var(--text-muted); padding: 60px; font-style: italic;">
                        <i class="fas fa-user-shield" style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;"></i>
                        <p>هیچ ادمینی یافت نشد</p>
                    </div>
                `;
                return;
            }
            
            const table = document.createElement('table');
            table.className = 'data-table';
            
            // Create header
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            const headers = [
                { text: 'نام کاربری', icon: 'fas fa-user' },
                { text: 'نام نمایشی', icon: 'fas fa-id-badge' },
                { text: 'نقش', icon: 'fas fa-crown' },
                { text: 'آخرین ورود', icon: 'fas fa-clock' },
                { text: 'وضعیت', icon: 'fas fa-info-circle' },
                { text: 'عملیات', icon: 'fas fa-tools' }
            ];
            
            headers.forEach(header => {
                const th = document.createElement('th');
                th.innerHTML = `<i class="${Security.sanitizeHtml(header.icon)}"></i> ${Security.sanitizeHtml(header.text)}`;
                headerRow.appendChild(th);
            });
            
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            // Create body
            const tbody = document.createElement('tbody');
            
            admins.forEach(admin => {
                const row = document.createElement('tr');
                
                // Username
                const usernameCell = document.createElement('td');
                usernameCell.style.cssText = 'font-weight: 600; color: var(--text-primary);';
                usernameCell.textContent = Security.sanitizeHtml(admin.username);
                
                // Display Name
                const displayNameCell = document.createElement('td');
                displayNameCell.textContent = Security.sanitizeHtml(admin.displayName);
                
                // Role
                const roleCell = document.createElement('td');
                const roleText = admin.role === 'super_admin' ? 'سوپر ادمین' : 'ادمین معمولی';
                const roleClass = admin.role === 'super_admin' ? 'status-active' : 'status-pending';
                const roleBadge = document.createElement('span');
                roleBadge.className = `status-badge ${roleClass}`;
                roleBadge.textContent = roleText;
                roleCell.appendChild(roleBadge);
                
                // Last Login
                const lastLoginCell = document.createElement('td');
                lastLoginCell.style.color = 'var(--text-secondary)';
                const lastLogin = admin.last_login ? new Date(admin.last_login).toLocaleDateString('fa-IR') : 'هرگز';
                lastLoginCell.textContent = lastLogin;
                
                // Status
                const statusCell = document.createElement('td');
                const statusClass = admin.status === 'active' ? 'status-active' : 'status-inactive';
                const statusText = admin.status === 'active' ? 'فعال' : 'غیرفعال';
                const statusBadge = document.createElement('span');
                statusBadge.className = `status-badge ${statusClass}`;
                statusBadge.textContent = statusText;
                statusCell.appendChild(statusBadge);
                
                // Actions
                const actionsCell = document.createElement('td');
                if (admin.username !== currentUsername) { // Can't delete yourself
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'form-button danger';
                    deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                    deleteBtn.title = 'حذف ادمین';
                    deleteBtn.onclick = () => deleteAdmin(admin.id);
                    actionsCell.appendChild(deleteBtn);
                } else {
                    actionsCell.innerHTML = '<span style="color: var(--text-muted); font-size: 12px;">خودتان</span>';
                }
                
                row.appendChild(usernameCell);
                row.appendChild(displayNameCell);
                row.appendChild(roleCell);
                row.appendChild(lastLoginCell);
                row.appendChild(statusCell);
                row.appendChild(actionsCell);
                
                tbody.appendChild(row);
            });
            
            table.appendChild(tbody);
            adminsContent.innerHTML = '';
            adminsContent.appendChild(table);
        }

        async function handleAddAdmin(e) {
            e.preventDefault();
            
            const usernameInput = document.getElementById('newAdminUsername');
            const passwordInput = document.getElementById('newAdminPassword');
            const displayNameInput = document.getElementById('newAdminDisplayName');
            const roleInput = document.getElementById('newAdminRole');
            
            if (!usernameInput || !passwordInput || !displayNameInput || !roleInput) {
                showMessage('addAdminError', 'خطا در فرم افزودن ادمین');
                return;
            }
            
            const username = usernameInput.value.trim();
            const password = passwordInput.value;
            const displayName = displayNameInput.value.trim();
            const role = roleInput.value;
            
            if (!Security.validateInput(username, 'username')) {
                showMessage('addAdminError', 'نام کاربری نامعتبر است');
                return;
            }
            
            if (!Security.validateInput(password, 'password')) {
                showMessage('addAdminError', 'رمز عبور نامعتبر است');
                return;
            }
            
            if (!Security.validateInput(displayName, 'text', { minLength: 2, maxLength: 50 })) {
                showMessage('addAdminError', 'نام نمایشی نامعتبر است');
                return;
            }
            
            if (!['admin', 'super_admin'].includes(role)) {
                showMessage('addAdminError', 'نقش انتخاب شده نامعتبر است');
                return;
            }
            
            // Check if username already exists
            if (admins.some(admin => admin.username === username)) {
                showMessage('addAdminError', 'نام کاربری قبلاً وجود دارد');
                return;
            }
            
            setLoadingState('addAdminForm', 'addAdminBtnText', 'addAdminSpinner', true);
            hideMessage('addAdminError');
            hideMessage('addAdminSuccess');
            
            try {
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                const newAdmin = {
                    id: Date.now(),
                    username,
                    password, // در محیط واقعی باید hash شود
                    displayName,
                    role,
                    created_at: new Date().toISOString(),
                    last_login: null,
                    status: 'active'
                };
                
                admins.push(newAdmin);
                
                // Add to CONFIG for login
                CONFIG.adminCredentials[username] = password;
                
                // Save to localStorage
                localStorage.setItem('toofan_admin_users', JSON.stringify(admins));
                
                // Clear form
                usernameInput.value = '';
                passwordInput.value = '';
                displayNameInput.value = '';
                roleInput.value = 'admin';
                
                showMessage('addAdminSuccess', `ادمین ${Security.sanitizeHtml(displayName)} با موفقیت اضافه شد`);
                renderAdminsSection();
                showNotification(`ادمین ${Security.sanitizeHtml(displayName)} اضافه شد`, 'success');
                
            } catch (error) {
                showMessage('addAdminError', 'خطا در افزودن ادمین');
            }
            
            setLoadingState('addAdminForm', 'addAdminBtnText', 'addAdminSpinner', false);
        }

        function deleteAdmin(adminId) {
            const admin = admins.find(a => a.id === adminId);
            if (!admin) return;
            
            if (confirm(`آیا مطمئن هستید که می‌خواهید ادمین ${admin.displayName} را حذف کنید؟`)) {
                admins = admins.filter(a => a.id !== adminId);
                
                // Remove from CONFIG
                delete CONFIG.adminCredentials[admin.username];
                
                // Save to localStorage
                localStorage.setItem('toofan_admin_users', JSON.stringify(admins));
                
                renderAdminsSection();
                showNotification(`ادمین ${Security.sanitizeHtml(admin.displayName)} حذف شد`, 'success');
            }
        }

        // Settings
        function saveSettings() {
            const maxFileSize = document.getElementById('maxFileSize');
            const sessionTimeout = document.getElementById('sessionTimeout');
            
            if (!maxFileSize || !sessionTimeout) {
                showNotification('خطا در دسترسی به تنظیمات', 'error');
                return;
            }
            
            const maxFileSizeValue = maxFileSize.value;
            const sessionTimeoutValue = sessionTimeout.value;
            
            if (!Security.validateInput(maxFileSizeValue, 'number', { min: 1, max: 1000 })) {
                showNotification('حداکثر اندازه فایل نامعتبر است', 'error');
                return;
            }
            
            if (!Security.validateInput(sessionTimeoutValue, 'number', { min: 60, max: 10080 })) {
                showNotification('زمان انقضای جلسه نامعتبر است', 'error');
                return;
            }
            
            try {
                sessionStorage.setItem('toofan_admin_max_file_size', maxFileSizeValue);
                sessionStorage.setItem('toofan_admin_session_timeout', sessionTimeoutValue);
                showNotification('تنظیمات با موفقیت ذخیره شد ✅', 'success');
            } catch (error) {
                showNotification('خطا در ذخیره تنظیمات', 'error');
            }
        }

        // Refresh Functions
        function refreshDashboard() {
            showLoading('در حال بروزرسانی داشبورد...');
            loadDashboardData().then(() => {
                hideLoading();
                showNotification('داشبورد بروزرسانی شد! 🔄', 'success');
            });
        }

        function refreshTicketsSection() {
            showLoading('در حال بروزرسانی تیکت‌ها...');
            loadTickets().then(() => {
                hideLoading();
                showNotification('تیکت‌ها بروزرسانی شد! 🔄', 'success');
            });
        }

        function refreshSystemSection() {
            showLoading('در حال بروزرسانی وضعیت سیستم...');
            loadSystemStatus().then(() => {
                hideLoading();
                showNotification('وضعیت سیستم بروزرسانی شد! 🔄', 'success');
            });
        }

        function refreshMonitorSection() {
            showLoading('در حال بروزرسانی مانیتورینگ...');
            loadRepresentatives().then(() => {
                hideLoading();
                showNotification('مانیتورینگ بروزرسانی شد! 🔄', 'success');
            });
        }

        function refreshAnalyticsSection() {
            showLoading('در حال بروزرسانی آمار...');
            loadAnalytics().then(() => {
                hideLoading();
                showNotification('آمار بروزرسانی شد! 🔄', 'success');
            });
        }

        function refreshAdminsSection() {
            showLoading('در حال بروزرسانی ادمین‌ها...');
            loadAdmins().then(() => {
                hideLoading();
                showNotification('ادمین‌ها بروزرسانی شد! 🔄', 'success');
            });
        }

        function refreshSettingsSection() {
            const usernameInput = document.getElementById('settingsUsername');
            const serverUrlInput = document.getElementById('currentServerUrl');
            
            if (usernameInput) usernameInput.value = currentUsername;
            if (serverUrlInput) serverUrlInput.value = getServerUrl();
            
            showNotification('تنظیمات بروزرسانی شد! 🔄', 'success');
        }

        // Utility Functions
        function setLoadingState(formId, textId, spinnerId, loading) {
            const form = document.getElementById(formId);
            const text = document.getElementById(textId);
            const spinner = document.getElementById(spinnerId);
            
            if (form) {
                const inputs = form.querySelectorAll('input, button, select, textarea');
                inputs.forEach(input => input.disabled = loading);
            }
            
            if (loading) {
                if (text) text.style.display = 'none';
                if (spinner) spinner.classList.remove('hidden');
            } else {
                if (text) text.style.display = 'inline';
                if (spinner) spinner.classList.add('hidden');
            }
        }

        function showMessage(elementId, message) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = Security.sanitizeHtml(message);
                element.classList.remove('hidden');
            }
        }

        function hideMessage(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.classList.add('hidden');
            }
        }

        function showNotification(message, type = 'success') {
            if (!message || typeof message !== 'string') return;
            if (!['success', 'error', 'info', 'warning'].includes(type)) type = 'success';
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icon = type === 'success' ? 'fa-check-circle' : 
                        type === 'error' ? 'fa-exclamation-circle' :
                        type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle';
            
            const iconEl = document.createElement('i');
            iconEl.className = `fas ${icon}`;
            
            const textEl = document.createElement('span');
            textEl.textContent = ` ${Security.sanitizeHtml(message)}`;
            
            notification.appendChild(iconEl);
            notification.appendChild(textEl);
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideInRight 0.3s ease reverse';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            try {
                initTheme();
                setupEventListeners();
                
                serverUrl = getServerUrl();
                
                // Check if already logged in
                const storedToken = sessionStorage.getItem(CONFIG.tokenKey);
                const storedUser = sessionStorage.getItem('toofan_admin_username');
                const loginTime = sessionStorage.getItem('toofan_admin_login_time');
                
                if (storedToken && storedUser && loginTime) {
                    const currentTime = Date.now();
                    const sessionAge = currentTime - parseInt(loginTime);
                    
                    if (sessionAge < CONFIG.sessionTimeout) {
                        authToken = storedToken;
                        currentUsername = Security.sanitizeHtml(storedUser);
                        showPanel();
                        loadDashboardData();
                        startAutoUpdate();
                    } else {
                        logout();
                        showNotification('جلسه منقضی شده است، لطفاً مجدداً وارد شوید', 'info');
                    }
                }
                
            } catch (error) {
                console.error('Initialization failed');
                showNotification('خطا در بارگذاری اولیه', 'error');
            }
        });

        function setupEventListeners() {
            const loginForm = document.getElementById('loginForm');
            const addMonitorForm = document.getElementById('addMonitorForm');
            const addAdminForm = document.getElementById('addAdminForm');
            
            if (loginForm) loginForm.addEventListener('submit', handleLogin);
            if (addMonitorForm) addMonitorForm.addEventListener('submit', handleAddMonitor);
            if (addAdminForm) addAdminForm.addEventListener('submit', handleAddAdmin);
        }

        // Auto theme detection
        if (window.matchMedia) {
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (!sessionStorage.getItem('toofan_admin_theme')) {
                    const themeIcon = document.getElementById('themeIcon');
                    if (event.matches) {
                        document.documentElement.setAttribute('data-theme', 'dark');
                        if (themeIcon) themeIcon.className = 'fas fa-moon';
                    } else {
                        document.documentElement.setAttribute('data-theme', 'light');
                        if (themeIcon) themeIcon.className = 'fas fa-sun';
                    }
                }
            });
        }

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
            
            // Destroy chart instances
            [dailyTrafficChartInstance, ticketStatusChartInstance, cpuChartInstance, ramChartInstance].forEach(chart => {
                if (chart) chart.destroy();
            });
        });
    </script>
</body>
</html>
